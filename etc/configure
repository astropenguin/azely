#!/bin/bash

PROJ=`pipenv --where`

# Write environment variables to .env
echo PYTHONPATH=${PROJ} >> .env
echo IPYTHONDIR=${PROJ}/.ipython >> .env
export $(grep -v '^#' .env | xargs)

# Create IPython profile
mkdir -p .ipython
ipython profile create default --ipython-dir .ipython

# Create Jupyter kernel
ipython kernel install --sys-prefix --profile default --display-name Default

# Create IPython startup
cat << EOS > $IPYTHONDIR/profile_default/startup/00.py
import re
import os
import sys
import time
from pathlib import Path
from datetime import datetime

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
EOS

# Create IPython config
cat << EOS > $IPYTHONDIR/profile_default/ipython_config.py
c.InteractiveShellApp.exec_lines = ['%autoreload 2']
c.InteractiveShellApp.extensions = ['autoreload']
EOS