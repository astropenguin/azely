# standard library
from io import StringIO


# dependencies
import azely
import pandas as pd
from pandas.testing import assert_frame_equal


# constants
data_jst = """\
JST,az,el
2020-02-01 00:00:00+09:00,99.52787116850293,-21.4449349365459
2020-02-01 01:00:00+09:00,93.2154944712506,-7.692616133218925
2020-02-01 02:00:00+09:00,87.30331750467298,6.144129808638512
2020-02-01 03:00:00+09:00,81.06602726093783,19.910547847909896
2020-02-01 04:00:00+09:00,73.62510035201585,33.415660279447565
2020-02-01 05:00:00+09:00,63.465995742487706,46.3109201132158
2020-02-01 06:00:00+09:00,47.433725743860876,57.76959088203396
2020-02-01 07:00:00+09:00,19.91507316237482,65.60616454216839
2020-02-01 08:00:00+09:00,342.72561299399564,65.93888054450701
2020-02-01 09:00:00+09:00,314.1625403565169,58.528037670807365
2020-02-01 10:00:00+09:00,297.4812921283207,47.240340289549636
2020-02-01 11:00:00+09:00,287.01965500364844,34.41482116170503
2020-02-01 12:00:00+09:00,279.439213246764,20.940275463632382
2020-02-01 13:00:00+09:00,273.1460992246669,7.185842675126935
2020-02-01 14:00:00+09:00,267.2345386291012,-6.651006736339084
2020-02-01 15:00:00+09:00,260.9795854201559,-20.415574612400327
2020-02-01 16:00:00+09:00,253.4917013449331,-33.915005739756204
2020-02-01 17:00:00+09:00,243.22172923266996,-46.79412384756109
2020-02-01 18:00:00+09:00,226.92159405367218,-58.20320224225273
2020-02-01 19:00:00+09:00,198.87393462341763,-65.88694940842359
2020-02-01 20:00:00+09:00,161.47116044426326,-65.9304606916979
2020-02-01 21:00:00+09:00,133.28613191341663,-58.30216144124836
2020-02-01 22:00:00+09:00,116.90129605901663,-46.91523415757775
2020-02-01 23:00:00+09:00,106.59201684718747,-34.04514139768103
"""

data_lst = """\
LST,az,el
0 days 19:10:12.608045389,99.52787116850293,-21.4449349365459
0 days 20:10:22.464493114,93.2154944712506,-7.692616133218925
0 days 21:10:32.320940840,87.30331750467298,6.144129808638512
0 days 22:10:42.177388566,81.06602726093783,19.910547847909896
0 days 23:10:52.033836291,73.62510035201585,33.415660279447565
1 days 00:11:01.890284020,63.465995742487706,46.3109201132158
1 days 01:11:11.746731746,47.433725743860876,57.76959088203396
1 days 02:11:21.603179472,19.91507316237482,65.60616454216839
1 days 03:11:31.459627197,342.72561299399564,65.93888054450701
1 days 04:11:41.316074923,314.1625403565169,58.528037670807365
1 days 05:11:51.172526356,297.4812921283207,47.240340289549636
1 days 06:12:01.028977786,287.01965500364844,34.41482116170503
1 days 07:12:10.885429220,279.439213246764,20.940275463632382
1 days 08:12:20.741880650,273.1460992246669,7.185842675126935
1 days 09:12:30.598332084,267.2345386291012,-6.651006736339084
1 days 10:12:40.454783514,260.9795854201559,-20.415574612400327
1 days 11:12:50.311234947,253.4917013449331,-33.915005739756204
1 days 12:13:00.167686377,243.22172923266996,-46.79412384756109
1 days 13:13:10.024137811,226.92159405367218,-58.20320224225273
1 days 14:13:19.880589244,198.87393462341763,-65.88694940842359
1 days 15:13:29.737040674,161.47116044426326,-65.9304606916979
1 days 16:13:39.593492108,133.28613191341663,-58.30216144124836
1 days 17:13:49.449943538,116.90129605901663,-46.91523415757775
1 days 18:13:59.306394972,106.59201684718747,-34.04514139768103
"""


# test functions
def test_calc_jst() -> None:
    df = azely.calc(
        "NGC1068",
        "ALMA AOS",
        "2020-02-01 JST; Tomorrow; 1h",
        source=None,
    )
    expected = pd.read_csv(
        StringIO(data_jst),
        index_col=0,
        parse_dates=True,
    )
    assert_frame_equal(
        df,
        expected,
        check_exact=False,
        check_freq=False,
        check_index_type=False,
    )


def test_calc_lst() -> None:
    df = azely.calc(
        "NGC1068",
        "ALMA AOS",
        "2020-02-01 JST; Tomorrow; 1h",
        source=None,
    )
    expected = pd.read_csv(
        StringIO(data_lst),
        index_col=0,
    )
    expected.index = expected.index.astype("m8[ns]")
    assert_frame_equal(
        df.in_lst,
        expected,
        check_exact=False,
        check_freq=False,
        check_index_type=False,
    )
